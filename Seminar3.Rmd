# Ggplot

## Motivation to Ggplot


Bár maga a base R [értve itt ilyenkor mindig a `plot` paranccsal készült ábrákat] segítségével is lehet ábrákat készíteni, ez az egyszerűségét leszámítva nagyon ritkán ajánlott. Helyette érdemes a ggplot2-t alkalmazni, amely bár komplexebb, mint a base R, a személyre szabhatóságának szinte nincs felső határa.



![](images/plot_ggplot.jpg){width="400"}

Ám amelett, hogy szebb ábráink lesznek van egy sokkal fontosabb ok, amiért a ggplotot használjuk. A csomag a nevét Leland Wilkinson **Grammar of Graphics** c. munkája után kapta (innen a *gg*), amelyben megfogalmazásra került lényegében az ideális ábrakészítő algoritmus struktúrája. Mivel a ggplot2 ezt az elvet követi, így meglátjátok majd, hogy bár sok dolgot kell fejben tartani, minden logikus benne. Miután sikerül elsajátítani ezt az anyagot (és némi utána olvasás után) bármilyen szükséges ábrát el fogtok tudni készíteni.

## Bevezetés

A ggplot2 telepíthető önállóan is, illetve ez a csomag része egy "csomaggyűjteménynek", amit `tidyverse`-nek hívnak. Jelenleg mi csak a ggplot2-vel fogunk foglalkozni, így annak telepítése és betöltése is bőven elegendő lesz. Így annak függvényébne, hogy le van-e már töltve a package telepítsük [`install.packages("ggplot2")`], vagy ne, majd töltsük be [`library(ggplot2)`]. A ggplot2 helyett lehet egyből a `tidyverse`-t is betölteni, azonban jelenleg a többi package redundáns nekünk.

```{r}
library(ggplot2)
```

A ggplot2-vel kapunk néhány kiegészítő adattáblát, az egyszerűség kedvéért használjuk most ezek közül a `diamonds`-t. Pillanatra tekintsük meg az adattábla felépítését:

```{r eval = F}
head(diamonds)
```

```{r echo = F}
diamonds %>% 
  head %>% 
  knitr::kable(caption = "A diamonds adattábla")
```

Lássuk az első ábránkat ggplottal!

```{r fig.cap="A legelső ábránk ggplot használatával"}
ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
  geom_point()
```

```{r}
library(tidyverse)
```


```{r}
diamonds
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point()
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(color = "blue")
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(size = 5)
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(color = "#FF9933")
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(shape = 3) # change the shape of the points
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(shape = 21)
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price)) + 
  geom_point(shape = 21, color = "blue", fill = "red")
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price, color = cut, shape = cut))  +
  geom_point()
```

```{r}
ggplot(data = diamonds, mapping = aes(x = depth, y = price, color = cut, shape = cut))  +
  geom_point() + 
  theme_classic() + 
  theme(
    axis.text = element_text(size = 30)
  )
```

```{r}
ggplot(data = diamonds) + 
  aes(x = depth, y = price, color = cut) + 
  geom_point() + 
  labs(x = "X-axis", y = "Y-axis", title = "Nice title", 
       color = "New legend title",
       subtitle = "Unknown years") + 
  scale_x_continuous(labels = function(x) str_c(x, "%"), limits = c(50, 70), expand = c(0, 0)) + 
  scale_color_manual(values = c("red", "blue", "orange", "green", "grey")) +
  ggdark::dark_theme_classic() +
  theme(plot.title = element_text(color = "red", face = "bold")) 
```


```{r}
theme_set(ggdark::dark_theme_bw())
```

```{r}
ggplot(diamonds, aes(depth, price)) +
  geom_point()
```

```{r}
ggplot(diamonds, aes(price)) + 
  geom_density(color = "red", fill = "yellow")
```

```{r}
ggplot(diamonds, aes(price)) +
  geom_histogram() + 
  scale_x_log10()
```

```{r}
ggplot(diamonds, aes(price)) +
  geom_boxplot()
```

```{r}
outlier_value <- boxplot(diamonds$price, plot = FALSE)$out
diamonds$price %in% outlier_value
```

```{r}
outlier_filter <- function(x) {
outlier_value <- boxplot(x, plot = FALSE)$out
x %in% outlier_value
}
```

```{r}
diamonds %>% 
  filter(!outlier_filter(price))
```

```{r}
ggplot(diamonds, aes(cut)) + 
  geom_bar()
```

`ctrl + shit + m`

```{r}
diamonds %>% 
  count(cut) %>% 
  ggplot(aes(cut, n)) + 
  geom_col()
```

```{r}
ggplot(data = diamonds, aes(depth, price)) + # 2 numerical variables
  geom_point()
```

```{r}
ggplot(data = diamonds, aes(cut, fill = color))  +
  geom_bar(color = "black", position = position_fill())
```

```{r}
diamonds %>% 
  count(cut, color) %>% 
  ggplot() + 
  aes(cut, color, fill = n) +
  geom_tile(color = "black")
```

```{r}
diamonds %>% 
  select_if(is.numeric) %>% 
  cor() %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  pivot_longer(-1) %>% 
  filter(rowname < name) %>% 
  ggplot() + 
  aes(x = rowname, y = name, fill = value) + 
  geom_tile(color = "black") + 
  scale_fill_gradient2(limits = c(-1, 1))
```



```{r}
eurostat::search_eurostat("employment") %>% 
  View()
```

```{r}
unemployment_df <- eurostat::get_eurostat("enpe_lfsa_urgan")
```

```{r}
unemployment_df <- unemployment_df %>% 
  filter(sex == "T" & age == "Y15-74") %>% 
  mutate(time = lubridate::year(time)) %>% 
  select(geo, time, unemployment = values)
```

```{r}
employment_df <- eurostat::get_eurostat("enpe_lfsa_ergan")
```


```{r}
employment_df <- employment_df %>% 
  filter(sex == "T" & age == "Y20-64" & unit == "RT") %>% 
  mutate(time = lubridate::year(time)) %>% 
  select(geo, time, employment = values)
```


```{r}
df <- full_join(x = employment_df, y = unemployment_df)
```

```{r}
df %>% 
  filter(geo == "GE") %>%
  ggplot() + 
  aes(x = time, y = unemployment) +
  geom_line()
```

```{r}
df %>% 
  filter(geo == "GE") %>% 
  ggplot() + 
  geom_line(aes(time, unemployment)) + 
  geom_line(aes(time, employment))
```

```{r}
df %>% 
  filter(geo == "GE") %>% 
  pivot_longer(employment:unemployment) %>% 
  ggplot() +
  aes(x = time, y = value, color = name) + 
  geom_line()
```

```{r}
df %>% 
  filter(geo == "GE") %>% 
  ggplot() + 
  aes(x = unemployment, y = employment, label = time)  +
  geom_path() + 
  geom_text()
```

